
{% extends "base.html" %}
{% load static %}
{% block head %}
<style>
    #two-factor-steps {
	border: 1px solid #ccc;
	border-radius: 3px;
	padding: 15px;
    }
    .row{
        margin: 0px;
    }
    .crossed{
        text-decoration: line-through;
    }
    </style>
<script src="{% static 'mfa/js/qrious.min.js' %}" type="text/javascript"></script>
<script type="text/javascript">
    $(document).ready(function addToken() {
        listToken()
    });
    function listToken() {
        $.ajax({
            "url":"{% url 'get_recovery_tokens' %}",dataType:"JSON",
            success:function (data) {
                let htmlkey="";
                for (let i = 0; i < data.keys.length; i++) {
                    if (data.enable[i] == 0)
                    {
                        htmlkey +="<pre class='crossed'>" +data.keys[i] + "</pre>" + "<br>"
                    }
                    else 
                    {
                        htmlkey +="<pre>" +data.keys[i] + "</pre>" + "<br>"
                    }
                };
                document.getElementById('tokens').innerHTML = htmlkey
            }
        })
    };
    function confirmRegenerateTokens() {
        $("#modal-title").html("Are you sure you want to regenerate your recovery tokens?")
        $("#modal-body").html("<button onclick='regenerateTokens()' class='btn btn-success'>Regenerate</button")
        $("#popUpModal").modal('show')
    }
    function regenerateTokens() {
        $.ajax({
            "url":"{% url 'regen_recovery_tokens' %}",
            success:function (data) {
                console.warn("ksfvkjs")
                listToken()
                $("#popUpModal").modal('hide')
            }
        })
    }
    </script>
{% endblock %}
{% block content %}
<br/>
<br/>
<div class="container d-flex justify-content-center">
    <div class="col-md-6 col-md-offset-3" id="two-factor-steps">
        <div class="row" align="center">
            <h4>Token List</h4>
        </div>
    
        <div id="tokens">
        
        </div>

        <div class="row" align="center">
            <button onclick="confirmRegenerateTokens()" class="btn btn-default btn-secondary" role="button">Regenarate tokens</button>
        </div>

        <div class="row">

            <div align="center" class="alert alert-success" style="display: none" id="return">

                <a href="{{redirect_html}}"> {{reg_success_msg}}</a>

            </div>
        </div>

    </div>
</div>
{% include "modal.html" %}
{% endblock %}
